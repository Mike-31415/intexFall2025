<!-- Group 2-11
 
Edit Donation page: allows admin/managers to edit information (date, amount, participant)
about a donation.

-->

<!DOCTYPE html>
<html>
<head>
        <title>Edit Donation</title>
        <link rel="stylesheet" href="/vendor/choices/choices.min.css">
        <link rel="stylesheet" href="/styles.css">
    </head>
<body>
        <%- include('partials/header') %>
        <div class="form-card">
            <h2>Edit Donation</h2>

            <% if (typeof error_message !== 'undefined' && error_message) { %>
                <div class="error-message"><%= error_message %></div>
            <% } %>

            <form action="/editDonations/<%= donation.donation_id %>" method="post">
                <% 
                    let donationDateVal = "";
                    if (donation.donation_date) {
                        const d = new Date(donation.donation_date);
                        if (!isNaN(d)) donationDateVal = d.toISOString().slice(0,10);
                    }
                %>
                <div class="form-row">
                    <label for="donation_date">Donation Date</label>
                    <input type="date" id="donation_date" name="donation_date" value="<%= donationDateVal %>">
                </div>

                <div class="form-row">
                    <label for="donation_amount">Donation Amount</label>
                    <input type="number" step="0.01" id="donation_amount" name="donation_amount" value="<%= donation.donation_amount %>" required>
                </div>

                <div class="form-row">
                    <label for="participant_id">Participant</label>
                    <select id="participant_id" name="participant_id" required>
                        <% participants.forEach(p => { %>
                            <option value="<%= p.participant_id %>" <%= p.participant_id === donation.participant_id ? 'selected' : '' %>>
                                <%= p.participant_first_name %> <%= p.participant_last_name %>
                            </option>
                        <% }) %>
                    </select>
                </div>

                <div class="buttons">
                    <button type="submit" class="btn btn-save">Update Donation</button>
                    <a href="/donations" class="btn btn-cancel">Cancel</a>
                </div>
            </form>
            <script src="/vendor/choices/choices.min.js"></script>
            <script>
                (function() {
                    const select = document.getElementById("participant_id");
                    if (select) {
                        new Choices(select, {
                            searchPlaceholder: "Type to search participants",
                            shouldSort: true,
                            searchResultLimit: 50,
                            allowHTML: false
                        });
                    }
                })();
            </script>
        </div>
    </body>
</html>


