<!DOCTYPE html>
<html>
    <head>
        <title>Edit Donation</title>
        <link rel="stylesheet" href="/styles.css">
    </head>
<body>
        <%- include('partials/header') %>
        <h1>Edit Donation</h1>

        <% if (typeof error_message !== 'undefined' && error_message) { %>
            <p style="color:red;"><%= error_message %></p>
        <% } %>

        <form action="/editDonations/<%= donation.donation_id %>" method="post">
            <label for="donation_date">Donation Date: </label>
            <% 
                let donationDateVal = "";
                if (donation.donation_date) {
                    const d = new Date(donation.donation_date);
                    if (!isNaN(d)) donationDateVal = d.toISOString().slice(0,10);
                }
            %>
            <input type="date" id="donation_date" name="donation_date" value="<%= donationDateVal %>">
            <br><br>

            <label for="donation_amount">Donation Amount: </label>
            <input type="number" step="0.01" id="donation_amount" name="donation_amount" value="<%= donation.donation_amount %>" required>
            <br><br>

            <label for="participant_id">Participant: </label>
            <select id="participant_id" name="participant_id" required>
                <% participants.forEach(p => { %>
                    <option value="<%= p.participant_id %>" <%= p.participant_id === donation.participant_id ? 'selected' : '' %>>
                        <%= p.participant_first_name %> <%= p.participant_last_name %>
                    </option>
                <% }) %>
            </select>
            <br><br>

            <input type="submit" value="Update Donation">
        </form>

        <br>
        <a href="/donations">Back to Donations</a>
        <script>
            // Set focus to the first input field when page loads
            window.addEventListener('DOMContentLoaded', function() {
                const firstInput = document.querySelector('input[type="text"]');
                if (firstInput) {
                    firstInput.focus();
                }
            });
        </script>
    </body>
</html>


