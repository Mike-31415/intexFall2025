<!-- Group 2-11
 
Add Milestones page: Allows admin/managers to add milestones for a participant. 

-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Milestones</title>
    <link rel="stylesheet" href="/vendor/choices/choices.min.css">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>

    <%- include('partials/header') %>

    <div class="form-card">
        <h2>Add Milestone</h2>

        <% if (error_message) { %>
            <div class="error-message"><%= error_message %></div>
        <% } %>

        <!-- 
            EXPECTED DATA PASSED IN:
            participants = [ { participantid, participantname }, ... ]
        -->

        <form action="/milestones/add" method="POST">

            <!-- Participant dropdown -->
            <div class="form-row">
                <label for="participantid">Participant</label>
                <select id="participantid" name="participantid" required>
                    <option value="">-- Select a participant --</option>
                    <% participants.forEach(p => { %>
                        <option value="<%= p.participantid %>" <%= (form_values && form_values.participantid == p.participantid) ? 'selected' : '' %>>
                            <%= p.participantname %>
                        </option>
                    <% }) %>
                </select>
            </div>

            <!-- Milestone title -->
            <div class="form-row">
                <label for="milestonetitle">Milestone Title</label>
                <input
                    type="text"
                    id="milestonetitle"
                    name="milestonetitle"
                    placeholder="Completed Workshop"
                    value="<%= form_values ? form_values.milestonetitle : '' %>"
                    required
                >
            </div>

            <!-- Milestone date -->
            <div class="form-row">
                <label for="milestonedate">Milestone Date</label>
                <input
                    type="date"
                    id="milestonedate"
                    name="milestonedate"
                    value="<%= form_values ? form_values.milestonedate : '' %>"
                    required
                >
            </div>

            <!-- Buttons -->
            <div class="form-row" style="margin-top: 20px;">
                <button type="submit" class="btn btn-primary">Add Milestone</button>
            </div>

            <div class="form-row" style="margin-top: 10px;">
                <a href="/milestones" class="btn btn-secondary">Cancel</a>
            </div>

        </form>
        <script src="/vendor/choices/choices.min.js"></script>
        <script>
            (function() {
                const select = document.getElementById("participantid");
                if (select) {
                    new Choices(select, {
                        searchPlaceholder: "Type to search participants",
                        shouldSort: true,
                        searchResultLimit: 50,
                        allowHTML: false
                    });
                }
            })();
        </script>
    </div>

</body>
</html>
